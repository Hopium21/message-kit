# Group chat

This is a reference app that will allow you to understand the potential and all of its features. Through many handlers, you will be able to understand different use cases:

- [AI](/templates/group/agents): Reply with GPT when called by `/agent`.
- [Tipping](/templates/group/tipping): Tip when a user replies with `/tip`.
- [Games](/templates/group/games): Handle frame games like `/game slot`, `/game wordle`
- [Transactions](/templates/group/transactions): Handle skills like `/send`, `/swap`, `/show`.
- [Loyalty](/templates/group/loyalty): Handle loyalty skills like `/points`, `/leaderboard`.
- [Split payments](/templates/group/splitpayments): Handle split payments like `/split`.

## Structure

```
group/
├── src/
│   ├── index.ts                # Index file of the app. // [!code hl] // [!code focus]
│   ├── skills.ts               # Skills // [!code hl] // [!code focus]
│   └── handler/
│         └── agent.ts          # Handles gpt agent. // [!code hl] // [!code focus]
│         └── tipping.ts        # Handles tipping. // [!code hl] // [!code focus]
│         └── game.ts           # Handles game frames. // [!code hl] // [!code focus]
│         └── loyalty.ts        # Handles loyalty. // [!code hl] // [!code focus]
│         └── splitpayments.ts  # Handles split payments. // [!code hl] // [!code focus]
│         └── transactions.ts   # Handles the transaction frame. // [!code hl] // [!code focus]
│   └── lib/
│         └── openai.ts         # Open AI middleware. // [!code hl] // [!code focus]
│         └── stack.ts          # Stack middleware. // [!code hl] // [!code focus]
│         └── resolver.ts       # Resolver middleware. // [!code hl] // [!code focus]
├── package.json
├── tsconfig.json
└── .env
```

## Main code

```tsx [src/index.ts]
import { run, HandlerContext } from "@xmtp/message-kit";
import { handler as splitpayment } from "./handler/splitpayment.js";

// Main function to run the app
run(
  async (context: HandlerContext) => {
    const {
      message: { typeId },
    } = context;
    switch (typeId) {
      case "reply":
        handleReply(context);
        break;
      case "remoteStaticAttachment":
        handleAttachment(context);
        break;
    }
    if (!context.group) {
      context.send("This is a group bot, add this address to a group");
    }
  },
  { attachments: true },
);
async function handleReply(context: HandlerContext) {
  const {
    v2client,
    getReplyChain,
    version,
    message: {
      content: { reference },
    },
  } = context;

  const { chain, isSenderInChain } = await getReplyChain(
    reference,
    version,
    v2client.address,
  );
  //await context.skill(chain);
}

// Handle attachment messages
async function handleAttachment(context: HandlerContext) {
  await splitpayment(context);
}

export async function helpHandler(context: HandlerContext) {
  const { skills } = context;
  const intro =
    "Available experiences:\n" +
    skills
      ?.flatMap((app) => app.skills)
      .map((skill) => `${skill.command} - ${skill.description}`)
      .join("\n") +
    "\nUse these skills to interact with specific apps.";
  context.send(intro);
}
```

## Run the app

Follow the steps below to run the app

::::steps

### Setup

```bash [cmd]
# Clone the repo
git clone https://github.com/ephemeraHQ/message-kit
# Go to the templates/group folder
cd templates/group
# Install the dependencies
yarn install
# Run the app
yarn dev
```

### Variables

Set up these variables in your app

```bash [cmd]
KEY= # the private key of the bot wallet
OPEN_AI_API_KEY= # your openai api key
STACK_API_KEY= # stack api key
```

::::
